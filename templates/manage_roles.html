{% extends "index.html" %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='roles.css') }}">
<h1>Role and Permission Management Dashboard</h1>
    <table>
        <thead>
            <tr>
                <th>Username</th>
                <th>Email</th>
                <th>Current Role</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.username }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.role }}</td>
                <td>
                    <form method="POST" action="{{ url_for('update_role', user_id=user._id) }}">
                        <select name="role">
                            {% for role in roles %}
                            <option value="{{ role.role_name }}" {% if role.role_name == user.role %}selected{% endif %}>
                                {{ role.role_name }}
                            </option>
                            {% endfor %}
                        </select>
                        <button type="submit">Update</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Role Statistics Chart -->
    <canvas id="roleChart"></canvas>
    <script>
        const ctx = document.getElementById('roleChart').getContext('2d');
        const roleChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: {{ roles | map(attribute='role_name') | list | tojson }},
                datasets: [{
                    label: '# of Users',
                    data: {{ roles | map(attribute='user_count') | list | tojson }},
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
{% endblock %}